@require "math"
@require "screens"

transparency(color, alpha)
  color-mix(unquote('in srgb'), color, rgb(255, 255, 255) (1 - alpha) * 100%)

darken(color, rate)
  color-mix(unquote('in srgb'), color, rgb(0, 0, 0) rate * 100%)

arc-points(r, x1, y1, x2, y2, mx, my)
  points = ()
  ab = sqrt(pow(x2 - x1, 2) + pow(y2 - y1, 2))
  angle = acos(unit(abs(x2 - x1) / ab, ''))
  sign-dx = abs(x2 - x1) / (x2 - x1)
  sign-dy = abs(y2 - y1) / (y2 - y1)

  for cx in (x1..x2)
    ac-h = (cx - x1) * (y2 - y1) / (x2 - x1)
    ac = sqrt(pow(cx - x1, 2) + pow(ac-h, 2))
    oc = sqrt(pow(r, 2) + pow(ac, 2) - ac * ab)
    cos-aoc = unit((2 * pow(r, 2) - ac * ab) / (2 * oc * r), '')
    ar = sqrt(2 * pow(r, 2) * (1 - cos-aoc))
    rc = r - oc
    cos-car = ar > 0 ? unit((pow(ac, 2) + pow(ar, 2) - pow(rc, 2)) / (2 * ac * ar), '') : 1
    car = cos-car < 1 ? acos(cos-car) : 0deg
    xar = angle - sign-dy * sign-dx * car
    dx = ar * cos(xar)
    dy = ar * sin(xar)

    push(points, join(' ', round(x1 + sign-dx * dx + mx, 2), round(y1 + sign-dy * dy + my, 2)))
  return unquote(join(',', points))

generate-play-polygon(r, size, margin)
  inner-size = size - margin
  mx = margin + inner-size * 0.05
  my = margin

  angle = atan(2)
  corner-dx = round(r + r * cos(angle))
  corner-dy = r - r * sin(angle)
  vertex-dx = round(r * cos(angle))
  vertex-dy = r * sin(angle)
  vertex-h = round(r * (1 - cos(angle)))

  polygon(
    arc-points(r, 0, r, corner-dx, corner-dy, mx, my),
    arc-points(r, inner-size - vertex-dx, inner-size / 2 - vertex-dy, inner-size - vertex-dx + vertex-h, inner-size / 2, mx, my),
    arc-points(r, inner-size - vertex-dx + vertex-h, inner-size / 2, inner-size - vertex-dx, inner-size / 2 + vertex-dy, mx, my),
    arc-points(r, corner-dx, inner-size - corner-dy, 0, inner-size - r, mx, my)
  )

generate-stop-polygon(r, size, margin)
  inner-size = size - margin
  mx = margin
  my = margin

  polygon(
    arc-points(r, 0, r, r, 0, mx, my),
    arc-points(r, inner-size - r, 0, inner-size, r, mx, my),
    arc-points(r, inner-size, inner-size - r, inner-size - r, inner-size, mx, my),
    arc-points(r, r, inner-size, 0, inner-size - r, mx, my)
  )

.control-button
  display flex
  justify-content center
  align-items center
  width 150px
  height 150px
  border-radius 50%
  background-color var(--primary-color)
  border none
  cursor pointer
  transition all 0.4s ease-in-out

  &:hover
    box-shadow 0 0 8px rgba(255, 255, 255, 0.4)

    @supports (color: color-mix(unquote('in srgb'), white, white))
      box-shadow 0 0 5px transparency(darken(var(--primary-color), 0.15), 0.9)
      background-color darken(var(--primary-color), 0.15)

  --play-polygon generate-play-polygon(10px, 90px, 11px)
  --stop-polygon generate-stop-polygon(10px, 90px, 11px)

  @keyframes stop-to-play
    0%
      clip-path var(--stop-polygon)
    100%
      clip-path var(--play-polygon)

  @keyframes play-to-stop
    0%
      clip-path var(--play-polygon)
    100%
      clip-path var(--stop-polygon)

  .icon
    width 100px
    height 100px
    clip-path var(--play-polygon)
    background-color var(--background-color)

    &.stop
      animation 0.5s ease-in-out 0s 1 normal forwards running play-to-stop

    &.play
      animation 0.5s ease-in-out 0s 1 normal forwards running stop-to-play

  +desktop-narrow()
    width 140px
    height 140px

    --play-polygon generate-play-polygon(9px, 85px, 11px)
    --stop-polygon generate-stop-polygon(9px, 85px, 11px)

    .icon
      width 95px
      height 95px

  +tablet()
    width 110px
    height 110px

    --play-polygon generate-play-polygon(7px, 70px, 10.5px)
    --stop-polygon generate-stop-polygon(7px, 70px, 10.5px)

    .icon
      width 80px
      height 80px

  +mobile()
    width 80px
    height 80px

    --play-polygon generate-play-polygon(5px, 52px, 8.5px)
    --stop-polygon generate-stop-polygon(5px, 52px, 8.5px)

    .icon
      width 60px
      height 60px

  +mobile-narrow()
    width 64px
    height 64px

    --play-polygon generate-play-polygon(4px, 40px, 5.5px)
    --stop-polygon generate-stop-polygon(4px, 40px, 5.5px)

    .icon
      width 45px
      height 45px
